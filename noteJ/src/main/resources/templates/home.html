<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js
"></script>
<link href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.min.css
" rel="stylesheet">
<!-- Include the header fragment -->
<div th:insert="~{fragments/header :: header}"></div>
<body>
<!-- Include the navigation fragment -->
<div th:insert="~{fragments/header :: navigation}">
</div>
<div>Home</div>
<div class="container-fluid">
    <div class="row">
        <div class="col-8">
            <div id="terminal" style="width: 100%; height: 400px;"></div>
        </div>
        <div class="col-4">
            ë¬´ì—‡ì´ ë“¤ì–´ê°€ë ¤ë‚˜
        </div>
    </div>
</div>

<script>
    function printAsciiArt(term) {
        const lines = [
            String.raw` $ â–â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–Œ`,
            String.raw` $ â–                                                                                   â–Œ`,
            String.raw` $ â–              _ _         __    __           _     _   _                           â–Œ`,
            String.raw` $ â–    /\  /\___| | | ___   / / /\ \ \___  _ __| | __| | / \                          â–Œ`,
            String.raw` $ â–   / /_/ / _ \ | |/ _ \  \ \/  \/ / _ \| '__| |/ _` + "`" + String.raw` |/  /                          â–Œ`,
            String.raw` $ â–  / __  /  __/ | | (_) |  \  /\  / (_) | |  | | (_| /\_/                           â–Œ`,
            String.raw` $ â–  \/ /_/ \___|_|_|\___/    \/  \/ \___/|_|  |_|\__,_\/                             â–Œ`,
            String.raw` $ â–                                                                                   â–Œ`,
            String.raw` $ â–   __    __     _                            _              __      _        __    â–Œ`,
            String.raw` $ â–  / / /\ \ \___| | ___ ___  _ __ ___   ___  | |_ ___     /\ \ \___ | |_ ___  \ \   â–Œ`,
            String.raw` $ â–  \ \/  \/ / _ \ |/ __/ _ \| '_ ` + "`" + String.raw` _ \ / _ \ | __/ _ \   /  \/ / _ \| __/ _ \  \ \  â–Œ`,
            String.raw` $ â–   \  /\  /  __/ | (_| (_) | | | | | |  __/ | || (_) | / /\  / (_) | ||  __/\_/ /  â–Œ`,
            String.raw` $ â–    \/  \/ \___|_|\___\___/|_| |_| |_|\___|  \__\___/  \_\ \/ \___/ \__\___\___/   â–Œ`,
            String.raw` $ â–                                                                                   â–Œ`,
            String.raw` $ â–â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–Œ`,
            String.raw` $  `
        ];
        lines.forEach(line => term.writeln(line));
    }



</script>
<script th:inline="javascript">
    /*<![CDATA[*/
    var username = /*[[${sessionUser != null and sessionUser.username != '' ? sessionUser.username : 'nologin'}]]*/ 'nologin';

    const prompt = (username && username !== 'nologin')
        ? " \x1b[1;3;94m" + username + "\x1b[0m" + "@notej:# ~ "
        : " \x1b[1;3;95m" + "nologin" + "\x1b[0m" + "@notej:# ~ ";

    console.log(prompt);
    /*]]>*/

    // í„°ë¯¸ë„ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ë° ì˜¤í”ˆ
    const term = new Terminal({
        fontFamily: 'Lucida Sans, monospace',
        fontSize: 14,
        letterSpacing: 0,
        lineHeight: 1.0,
        cols: 200
    });
    term.resize(200, 30);
    term.open(document.getElementById('terminal'));
    term.focus();

    // ì´ˆê¸° í”„ë¡¬í”„íŠ¸ ì„¤ì • ë° ì•ˆë‚´ ë©”ì‹œì§€ ì¶œë ¥
    term.writeln(' $');
    term.writeln(' $ ğŸš€  NOTEJì— ì˜¤ì‹ ê±¸ í™˜ì˜í•©ë‹ˆë‹¤ \x1B[1;3;32m\'help\'\x1B[0m ëª…ë ¹ì–´ë¡œ í•˜ì—¬ê¸ˆ ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•´ë³´ì„¸ìš”!');
    term.writeln(' $');
    printAsciiArt(term);
    term.write(prompt);

    // ì»¤ë§¨ë“œ ë²„í¼ ë° íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™”
    var commandBuffer = '';
    var commandHistory = []; // ì´ì „ì— ì…ë ¥í•œ ëª…ë ¹ì–´ë“¤ì„ ì €ì¥
    var historyIndex = 0;    // í˜„ì¬ íˆìŠ¤í† ë¦¬ ì¸ë±ìŠ¤. ê¸°ë³¸ì ìœ¼ë¡œ íˆìŠ¤í† ë¦¬ì˜ ë(ìƒˆë¡œìš´ ëª…ë ¹ ì…ë ¥ ìƒíƒœ)

    function processCommand(cmd) {
        // ì˜ˆì‹œ: 'help' ëª…ë ¹ì–´ì— ëŒ€í•œ ì²˜ë¦¬. ì‹¤ì œ êµ¬í˜„ì— ë§ê²Œ ìˆ˜ì •í•˜ì„¸ìš”.
        fetch('/api/execute-command', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ command: cmd })
        })
            .then(response => response.json())
            .then(data => {
                console.log(data.result);
                term.writeln('\r\n' + data.result);
                term.write(prompt);
            })
            .catch(error => {
                term.writeln('\r\nError: ' + error);
                term.write(prompt);
            });
    }

    // í‚¤ ì…ë ¥ ì´ë²¤íŠ¸ ì²˜ë¦¬
    term.onData(function(data) {
        // í™”ì‚´í‘œ í‚¤ (ìœ„: \x1b[A, ì•„ë˜: \x1b[B) ì²˜ë¦¬
        if (data === '\x1b[A') {  // Up arrow
            if (commandHistory.length > 0) {
                // íˆìŠ¤í† ë¦¬ ì¸ë±ìŠ¤ê°€ 0ë³´ë‹¤ í¬ë©´ ìœ„ë¡œ ì´ë™
                if (historyIndex > 0) {
                    historyIndex--;
                }
                // í˜„ì¬ íˆìŠ¤í† ë¦¬ ëª…ë ¹ì–´ë¡œ commandBuffer ì„¤ì •
                commandBuffer = commandHistory[historyIndex];
                // í˜„ì¬ ì¤„ í´ë¦¬ì–´ í›„ í”„ë¡¬í”„íŠ¸ì™€ commandBuffer ì¬ì¶œë ¥
                term.write('\x1B[2K\r' + prompt + commandBuffer);
            }
        }
        else if (data === '\x1b[B') {  // Down arrow
            if (commandHistory.length > 0) {
                if (historyIndex < commandHistory.length - 1) {
                    historyIndex++;
                    commandBuffer = commandHistory[historyIndex];
                } else {
                    // ë§ˆì§€ë§‰ ëª…ë ¹ì–´ ì´í›„ì—ëŠ” ë¹ˆ ë¬¸ìì—´ë¡œ ì´ˆê¸°í™”
                    historyIndex = commandHistory.length;
                    commandBuffer = '';
                }
                term.write('\x1B[2K\r' + prompt + commandBuffer);
            }
        }
        // ë°±ìŠ¤í˜ì´ìŠ¤ ì²˜ë¦¬: ì¼ë°˜ì ìœ¼ë¡œ \x7F ë˜ëŠ” \b
        else if (data === '\x7F' || data === '\b') {
            if (commandBuffer.length > 0) {
                commandBuffer = commandBuffer.slice(0, -1);
                term.write('\x1B[2K\r' + prompt + commandBuffer);
            }
        }
        // ì—”í„° ì²˜ë¦¬: ì¤„ë°”ê¿ˆ í›„ í”„ë¡¬í”„íŠ¸ ì¬ì¶œë ¥
        else if (data === '\r') {
            term.write('\r\n');
            if (commandBuffer.trim() !== '') {
                // ëª…ë ¹ì–´ë¥¼ íˆìŠ¤í† ë¦¬ì— ì €ì¥ (ì„±ê³µ ì—¬ë¶€ì™€ ìƒê´€ì—†ì´)
                commandHistory.push(commandBuffer);
                // íˆìŠ¤í† ë¦¬ì˜ ê¸¸ì´ê°€ 30ê°œë¥¼ ì´ˆê³¼í•˜ë©´ ê°€ì¥ ì˜¤ë˜ëœ í•­ëª© ì œê±°
                if (commandHistory.length > 30) {
                    commandHistory.shift();
                }
                // íˆìŠ¤í† ë¦¬ ì¸ë±ìŠ¤ë¥¼ íˆìŠ¤í† ë¦¬ì˜ ëìœ¼ë¡œ ì—…ë°ì´íŠ¸
                historyIndex = commandHistory.length;

                if (username !== 'nologin') {
                    processCommand(commandBuffer);
                    console.log("ëª…ë ¹ì–´ ì„œë²„ ì „ë‹¬ í•¨ìˆ˜ ì½œ ì™„ë£Œ");
                    console.log(commandBuffer);
                } else {
                    term.writeln("âš ï¸  ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤ ğŸš«");
                    term.write(prompt);
                }
            } else {
                term.write(prompt);
            }
            commandBuffer = '';
        }
        // ì¼ë°˜ ë¬¸ì ì…ë ¥ ì²˜ë¦¬
        else {
            commandBuffer += data;
            term.write(data);
        }
    });
</script>


<!-- Bootstrap JS -->
</body>
</html>
