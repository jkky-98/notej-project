<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js
"></script>
<link href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.min.css
" rel="stylesheet">
<!-- Include the header fragment -->
<div th:insert="~{fragments/header :: header}"></div>
<body>
<!-- Include the navigation fragment -->
<div th:insert="~{fragments/header :: navigation}">
</div>
<div class="container-fluid m-3">
    <div class="row mt-4">
        <div class="col-md-9 col-auto">
            <h2 class="mb-2 fw-bold">User Dashboard</h2>
            <h6 class="text-body-tertiary fw-semibold">ëŒ€ì‹œë³´ë“œë¥¼ í†µí•´ ë¸”ë¡œê·¸ í†µê³„ ì¶”ì  ë° ê´€ë¦¬ë¥¼ í•´ë³´ì„¸ìš”!</h6>
        </div>
    </div>
    <div class="row">
        <div class="col-6">
            <div class="card h-100 shadow-sm rounded-lg">
                <div class="card-header">
                    <h5 class="card-title mb-0">Terminal</h5>
                    <small class="text-muted">ëª…ë ¹ì–´ë¥¼ í†µí•´ ë¸”ë¡œê·¸ ê´€ë¦¬ ë° í†µê³„ê¸°ëŠ¥ì„ ìˆ˜í–‰í•´ë³´ì„¸ìš”.</small>
                </div>
                <div class="card-body p-0">
                    <div id="terminal" style="width: 100%; height: 400px;"></div>
                </div>
            </div>
        </div>

        <div class="col-6">
            <div class="row g-3">
                <div class="col-12 col-md-6">
                    <div class="card h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h5 class="mb-1">Month Views<span class="badge badge-phoenix badge-phoenix-warning rounded-pill fs-9 ms-2"><span class="badge-label">-6.8%</span></span></h5>
                                    <h6 class="text-body-tertiary">Views Increased by X% from Last Month</h6>
                                </div>
                                <h4>6,247</h4>
                            </div>
                            <div class="d-flex justify-content-center px-4 py-6">
                                <div th:insert="~{fragments/progressBarHome :: progressBarHome}"></div>
                            </div>
                            <div class="mt-2">
                                <div class="d-flex align-items-center mb-2">
                                    <div class="bullet-item bg-primary me-2"></div>
                                    <h6 class="text-body fw-semibold flex-1 mb-0">ì§€ë‚œ ë‹¬ì— ë¹„í•´ 77% ìƒìŠ¹</h6>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-md-6">
                    <div class="card h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h5 class="mb-1">New customers<span class="badge badge-phoenix badge-phoenix-warning rounded-pill fs-9 ms-2"> <span class="badge-label">+26.5%</span></span></h5>
                                    <h6 class="text-body-tertiary">Last 7 days</h6>
                                </div>
                                <h4>356</h4>
                            </div>
                            <div class="pb-0 pt-4">
                                <div class="echarts-new-customers" style="height: 180px; width: 100%; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); position: relative;" _echarts_instance_="ec_1739862395147"><div style="position: relative; width: 506px; height: 180px; padding: 0px; margin: 0px; border-width: 0px;"><canvas data-zr-dom-id="zr_0" width="506" height="180" style="position: absolute; left: 0px; top: 0px; width: 506px; height: 180px; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); padding: 0px; margin: 0px; border-width: 0px;"></canvas><canvas data-zr-dom-id="zr_2" width="506" height="180" style="position: absolute; left: 0px; top: 0px; width: 506px; height: 180px; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); padding: 0px; margin: 0px; border-width: 0px;"></canvas></div><div class=""></div></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-md-6">
                    <div class="card h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h5 class="mb-2">Top coupons</h5>
                                    <h6 class="text-body-tertiary">Last 7 days</h6>
                                </div>
                            </div>
                            <div class="pb-4 pt-3">
                                <div class="echart-top-coupons" style="height: 115px; width: 100%; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); position: relative;" _echarts_instance_="ec_1739862395148"><div style="position: relative; width: 506px; height: 115px; padding: 0px; margin: 0px; border-width: 0px; cursor: default;"><canvas data-zr-dom-id="zr_0" width="506" height="115" style="position: absolute; left: 0px; top: 0px; width: 506px; height: 115px; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); padding: 0px; margin: 0px; border-width: 0px;"></canvas><div style="position: absolute !important; visibility: hidden !important; padding: 0px !important; margin: 0px !important; border-width: 0px !important; user-select: none !important; width: 0px !important; height: 0px !important; inset: 0px auto auto 0px !important;"></div><div style="position: absolute !important; visibility: hidden !important; padding: 0px !important; margin: 0px !important; border-width: 0px !important; user-select: none !important; width: 0px !important; height: 0px !important; inset: 0px 0px auto auto !important;"></div><div style="position: absolute !important; visibility: hidden !important; padding: 0px !important; margin: 0px !important; border-width: 0px !important; user-select: none !important; width: 0px !important; height: 0px !important; inset: auto auto 0px 0px !important;"></div><div style="position: absolute !important; visibility: hidden !important; padding: 0px !important; margin: 0px !important; border-width: 0px !important; user-select: none !important; width: 0px !important; height: 0px !important; inset: auto 0px 0px auto !important;"></div></div><div class="" style="position: absolute; display: block; border-style: solid; white-space: nowrap; box-shadow: rgba(0, 0, 0, 0.2) 1px 2px 10px; background-color: rgb(239, 242, 246); border-width: 1px; border-radius: 4px; color: rgb(20, 24, 36); font: 14px / 21px sans-serif; padding: 7px 10px; top: 0px; left: 0px; transform: translate3d(21px, 10px, 0px); border-color: rgb(203, 208, 221); z-index: 1000; pointer-events: none; visibility: hidden; opacity: 0;"><strong>Percentage discount:</strong> 72%</div></div>
                            </div>
                            <div>
                                <div class="d-flex align-items-center mb-2">
                                    <div class="bullet-item bg-primary me-2"></div>
                                    <h6 class="text-body fw-semibold flex-1 mb-0">Percentage discount</h6>
                                    <h6 class="text-body fw-semibold mb-0">72%</h6>
                                </div>
                                <div class="d-flex align-items-center mb-2">
                                    <div class="bullet-item bg-primary-lighter me-2"></div>
                                    <h6 class="text-body fw-semibold flex-1 mb-0">Fixed card discount</h6>
                                    <h6 class="text-body fw-semibold mb-0">18%</h6>
                                </div>
                                <div class="d-flex align-items-center">
                                    <div class="bullet-item bg-info-dark me-2"></div>
                                    <h6 class="text-body fw-semibold flex-1 mb-0">Fixed product discount</h6>
                                    <h6 class="text-body fw-semibold mb-0">10%</h6>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-md-6">
                    <div class="card h-100">
                        <div class="card-body d-flex flex-column">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h5 class="mb-2">Paying vs non paying</h5>
                                    <h6 class="text-body-tertiary">Last 7 days</h6>
                                </div>
                            </div>
                            <div class="d-flex justify-content-center pt-3 flex-1">
                                <div class="echarts-paying-customer-chart" style="height: 100%; width: 100%; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); position: relative;" _echarts_instance_="ec_1739862395151"><div style="position: relative; width: 506px; height: 144px; padding: 0px; margin: 0px; border-width: 0px;"><canvas data-zr-dom-id="zr_0" width="506" height="144" style="position: absolute; left: 0px; top: 0px; width: 506px; height: 144px; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); padding: 0px; margin: 0px; border-width: 0px;"></canvas></div><div class=""></div></div>
                            </div>
                            <div class="mt-3">
                                <div class="d-flex align-items-center mb-2">
                                    <div class="bullet-item bg-primary me-2"></div>
                                    <h6 class="text-body fw-semibold flex-1 mb-0">Paying customer</h6>
                                    <h6 class="text-body fw-semibold mb-0">30%</h6>
                                </div>
                                <div class="d-flex align-items-center">
                                    <div class="bullet-item bg-primary-subtle me-2"></div>
                                    <h6 class="text-body fw-semibold flex-1 mb-0">Non-paying customer</h6>
                                    <h6 class="text-body fw-semibold mb-0">70%</h6>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
<!--            <div th:insert="~{fragments/progressBarHome :: progressBarHome}">-->
<!--            </div>-->
        </div>
    </div>
</div>

<script>
    function printAsciiArt(term) {
        // ì‚¬ìš©ì ì§€ì • ìƒ‰ìƒê³¼ ë¦¬ì…‹ ì½”ë“œ (ANSI escape sequence)
        const userColor = "\x1b[38;2;0;123;255m";
        const resetColor = "\x1b[0m";

        const lines = [
            String.raw` $ â–â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–Œ`,
            String.raw` $ â–                                                                                   â–Œ`,
            String.raw` $ â–              _ _         __    __           _     _   _                           â–Œ`,
            String.raw` $ â–    /\  /\___| | | ___   / / /\ \ \___  _ __| | __| | / \                          â–Œ`,
            String.raw` $ â–   / /_/ / _ \ | |/ _ \  \ \/  \/ / _ \| '__| |/ _` + "`" + String.raw` |/  /                          â–Œ`,
            String.raw` $ â–  / __  /  __/ | | (_) |  \  /\  / (_) | |  | | (_| /\_/                           â–Œ`,
            String.raw` $ â–  \/ /_/ \___|_|_|\___/    \/  \/ \___/|_|  |_|\__,_\/                             â–Œ`,
            String.raw` $ â–                                                                                   â–Œ`,
            String.raw` $ â–   __    __     _                            _              __      _        __    â–Œ`,
            String.raw` $ â–  / / /\ \ \___| | ___ ___  _ __ ___   ___  | |_ ___     /\ \ \___ | |_ ___  \ \   â–Œ`,
            String.raw` $ â–  \ \/  \/ / _ \ |/ __/ _ \| '_ ` + "`" + String.raw` _ \ / _ \ | __/ _ \   /  \/ / _ \| __/ _ \  \ \  â–Œ`,
            String.raw` $ â–   \  /\  /  __/ | (_| (_) | | | | | |  __/ | || (_) | / /\  / (_) | ||  __/\_/ /  â–Œ`,
            String.raw` $ â–    \/  \/ \___|_|\___\___/|_| |_| |_|\___|  \__\___/  \_\ \/ \___/ \__\___\___/   â–Œ`,
            String.raw` $ â–                                                                                   â–Œ`,
            String.raw` $ â–â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–Œ`,
            String.raw` $  `
        ];

        lines.forEach(line => {
            // ë§Œì•½ ì–‘ìª½ì— í…Œë‘ë¦¬ ì—­í• ì˜ 'â–'ì™€ 'â–Œ'ê°€ ìˆë‹¤ë©´,
            const leftIndex = line.indexOf('â–');
            const rightIndex = line.lastIndexOf('â–Œ');

            // ì–‘ìª½ í…Œë‘ë¦¬ê°€ ë°œê²¬ë˜ì—ˆê³ , ê·¸ ì‚¬ì´ì— ë‚´ìš©ì´ ìˆëŠ” ê²½ìš°
            if (leftIndex !== -1 && rightIndex !== -1 && rightIndex > leftIndex) {
                const left = line.substring(0, leftIndex + 1);
                const middle = line.substring(leftIndex + 1, rightIndex);
                const right = line.substring(rightIndex);

                /*
                   ë§Œì•½ ë°•ìŠ¤ ë‚´ë¶€ ë‚´ìš©ì´ ë‹¨ìˆœ ê³µë°±ì´ë‚˜ ë°˜ë³µë˜ëŠ” í…Œë‘ë¦¬ ë¬¸ì(ì˜ˆ: 'â–€', 'â–„')ë¡œë§Œ êµ¬ì„±ë˜ì–´ ìˆë‹¤ë©´
                   (ì¦‰, borderë¼ì¸ì¸ ê²½ìš°)ì—ëŠ” ìƒ‰ìƒì„ ì ìš©í•˜ì§€ ì•Šê³  ê·¸ëŒ€ë¡œ ì¶œë ¥í•©ë‹ˆë‹¤.
                */
                if (/^[\sâ–€â–„]+$/.test(middle)) {
                    term.writeln(line);
                } else {
                    term.writeln(left + userColor + middle + resetColor + right);
                }
            } else {
                // í…Œë‘ë¦¬ íŒ¨í„´ì´ ì—†ëŠ” ë¼ì¸ì€ ê·¸ëŒ€ë¡œ ì¶œë ¥
                term.writeln(line);
            }
        });
    }



</script>
<script th:inline="javascript">
    /*<![CDATA[*/
    var username = /*[[${sessionUser != null and sessionUser.username != '' ? sessionUser.username : 'nologin'}]]*/ 'nologin';

    const prompt = (username && username !== 'nologin')
        ? " \x1b[1;3;94m" + username + "\x1b[0m" + "@notej:# ~ "
        : " \x1b[1;3;95m" + "nologin" + "\x1b[0m" + "@notej:# ~ ";

    // ì‚¬ìš©ì ì…ë ¥ ê¸€ìì— ì ìš©í•  ìƒ‰ìƒ (RGB: 0,123,255)
    const userColor = "\x1b[38;2;0;123;255m";
    const resetColor = "\x1b[0m";

    console.log(prompt);

    // í„°ë¯¸ë„ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ë° ì˜¤í”ˆ
    const term = new Terminal({
        fontFamily: 'Lucida Sans, monospace',
        fontSize: 14,
        letterSpacing: 0,
        lineHeight: 1.0,
        cols: 120,
        rows: 35,
        theme: {
            background: '#ffffff',   // ë°°ê²½ìƒ‰
            foreground: '#000000',   // ê¸°ë³¸ ê¸€ììƒ‰ (í”„ë¡¬í”„íŠ¸ ë“±)
            cursor: '#007bff',       // ì»¤ì„œ ìƒ‰ìƒ
            cursorAccent: '#ffffff'  // ì»¤ì„œ ë‚´ë¶€ í…ìŠ¤íŠ¸ ìƒ‰ìƒ
        },
        cursorBlink: true  // ì»¤ì„œ ê¹œë¹¡ì„ í™œì„±í™”
    });

    term.open(document.getElementById('terminal'));
    term.focus();

    // ì´ˆê¸° í”„ë¡¬í”„íŠ¸ ë° ì•ˆë‚´ ë©”ì‹œì§€ ì¶œë ¥
    term.writeln(' $');
    term.writeln(' $ ğŸš€  NOTEJì— ì˜¤ì‹ ê±¸ í™˜ì˜í•©ë‹ˆë‹¤ ' + userColor + '\'help\'' + resetColor + ' ëª…ë ¹ì–´ë¡œ ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•´ë³´ì„¸ìš”!');
    term.writeln(' $');
    printAsciiArt(term);
    term.write(prompt);

    // ì»¤ë§¨ë“œ ë²„í¼ ë° íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™”
    var commandBuffer = '';
    var commandHistory = []; // ì´ì „ì— ì…ë ¥í•œ ëª…ë ¹ì–´ë“¤ì„ ì €ì¥
    var historyIndex = 0;    // í˜„ì¬ íˆìŠ¤í† ë¦¬ ì¸ë±ìŠ¤. ê¸°ë³¸ì ìœ¼ë¡œ íˆìŠ¤í† ë¦¬ì˜ ë(ìƒˆë¡œìš´ ëª…ë ¹ ì…ë ¥ ìƒíƒœ)

    function redrawCommandBuffer() {
        // í˜„ì¬ ì¤„ í´ë¦¬ì–´ í›„ í”„ë¡¬í”„íŠ¸ì™€ ìƒ‰ìƒì´ ì ìš©ëœ ì»¤ë§¨ë“œ ë²„í¼ ì¬ì¶œë ¥
        term.write('\x1B[2K\r' + prompt + userColor + commandBuffer + resetColor);
    }

    function processCommand(cmd) {
        if (cmd === "help") {
            term.writeln(" ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´(ë¡œê·¸ì¸ í•„ìš”)");
            term.writeln("    - like all: ì‚¬ìš©ìê°€ ì–»ì€ ì´ ì¢‹ì•„ìš” ê°œìˆ˜ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤.");
            term.writeln('    - like all series = "seriesName": seriesNameì— ì†Œì†ëœ ê²Œì‹œê¸€ë“¤ì˜ ì´ ì¢‹ì•„ìš” ê°œìˆ˜ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤.');
            term.write(prompt);
            return;
        }

        // ì˜ˆì‹œ: 'help' ëª…ë ¹ì–´ì— ëŒ€í•œ ì²˜ë¦¬. ì‹¤ì œ êµ¬í˜„ì— ë§ê²Œ ìˆ˜ì •í•˜ì„¸ìš”.
        fetch('/api/execute-command', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ command: cmd })
        })
            .then(response => response.json())
            .then(data => {
                console.log(data.result);
                term.writeln('\r\n' + data.result);
                term.write(prompt);
            })
            .catch(error => {
                term.writeln('\r\nError: ' + error);
                term.write(prompt);
            });
    }

    // í‚¤ ì…ë ¥ ì´ë²¤íŠ¸ ì²˜ë¦¬
    term.onData(function(data) {
        // í™”ì‚´í‘œ í‚¤ (ìœ„: \x1b[A, ì•„ë˜: \x1b[B) ì²˜ë¦¬
        if (data === '\x1b[A') {  // Up arrow
            if (commandHistory.length > 0) {
                if (historyIndex > 0) {
                    historyIndex--;
                }
                commandBuffer = commandHistory[historyIndex];
                redrawCommandBuffer();
            }
        }
        else if (data === '\x1b[B') {  // Down arrow
            if (commandHistory.length > 0) {
                if (historyIndex < commandHistory.length - 1) {
                    historyIndex++;
                    commandBuffer = commandHistory[historyIndex];
                } else {
                    historyIndex = commandHistory.length;
                    commandBuffer = '';
                }
                redrawCommandBuffer();
            }
        }
        // ë°±ìŠ¤í˜ì´ìŠ¤ ì²˜ë¦¬: ì¼ë°˜ì ìœ¼ë¡œ \x7F ë˜ëŠ” \b
        else if (data === '\x7F' || data === '\b') {
            if (commandBuffer.length > 0) {
                commandBuffer = commandBuffer.slice(0, -1);
                redrawCommandBuffer();
            }
        }
        // ì—”í„° ì²˜ë¦¬: ì¤„ë°”ê¿ˆ í›„ í”„ë¡¬í”„íŠ¸ ì¬ì¶œë ¥
        else if (data === '\r') {
            term.write('\r\n');
            if (commandBuffer.trim() !== '') {
                commandHistory.push(commandBuffer);
                if (commandHistory.length > 30) {
                    commandHistory.shift();
                }
                historyIndex = commandHistory.length;

                if (username !== 'nologin') {
                    processCommand(commandBuffer);
                    console.log("ëª…ë ¹ì–´ ì„œë²„ ì „ë‹¬ í•¨ìˆ˜ ì½œ ì™„ë£Œ");
                    console.log(commandBuffer);
                } else {
                    term.writeln("âš ï¸  ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤ ğŸš«");
                    term.write(prompt);
                }
            } else {
                term.write(prompt);
            }
            commandBuffer = '';
        }
        // ì¼ë°˜ ë¬¸ì ì…ë ¥ ì²˜ë¦¬
        else {
            commandBuffer += data;
            // ì¶œë ¥ ì‹œë§ˆë‹¤ ì‚¬ìš©ì ì…ë ¥ ê¸€ìëŠ” ì§€ì •í•œ ìƒ‰ìƒìœ¼ë¡œ ì ìš©
            term.write(userColor + data + resetColor);
        }
    });
    /*]]>*/
</script>



<!-- Bootstrap JS -->
</body>
</html>
